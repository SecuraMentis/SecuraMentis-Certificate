<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SecuraMentis Abschluss</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <script>
    window.onload = function () {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "landscape" });

      // Daten aus URL-Parametern holen
      const params = new URLSearchParams(window.location.search);
      const kap1 = params.get("k1");
      const kap2 = params.get("k2");
      const kap3 = params.get("k3");
      const kap4 = params.get("k4");
      const kap5 = params.get("k5");
      const score = params.get("score");
      const leitsatz = params.get("leitsatz");

      const fallback = (val) => val ? val : "—";

      // Bild vorbereiten
      const img = new Image();
      img.src = "SecuraMentis_Certificate_Template.png"; // Bild liegt im Hauptordner

      img.onload = function () {
        // Dynamisches Einpassen des Bildes ins A4 Querformat
        const pageWidth = doc.internal.pageSize.getWidth();   // 297 mm
        const pageHeight = doc.internal.pageSize.getHeight(); // 210 mm
        const imgRatio = img.width / img.height;

        let imgWidth = pageWidth;
        let imgHeight = pageWidth / imgRatio;

        if (imgHeight > pageHeight) {
          imgHeight = pageHeight;
          imgWidth = pageHeight * imgRatio;
        }

        const xOffset = (pageWidth - imgWidth) / 2;
        const yOffset = (pageHeight - imgHeight) / 2;

        // Bild einfügen
        doc.addImage(img, "PNG", xOffset, yOffset, imgWidth, imgHeight);

        // Textinhalt einfügen
        doc.setFont("helvetica", "bold");
        doc.setFontSize(18);
        doc.setTextColor("#00235F");
   
        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text("Kapitel 1 abgeschlossen am: " + fallback(kap1), 30, 120);
        doc.text("Kapitel 2 abgeschlossen am: " + fallback(kap2), 30, 125);
        doc.text("Kapitel 3 abgeschlossen am: " + fallback(kap3), 30, 130);
        doc.text("Kapitel 4 abgeschlossen am: " + fallback(kap4), 30, 135);
        doc.text("Kapitel 5 abgeschlossen am: " + fallback(kap5), 30, 140);
        doc.text("Quiz Score: " + fallback(score), 20, 155);

        doc.setFont("helvetica", "italic");
        doc.setFontSize(11);
        doc.text("Dein persönlicher Leitsatz:", 30, 170);
        doc.setFontSize(10);
        doc.text(doc.splitTextToSize(fallback(leitsatz), 250), 30, 200);
        
        const signature = new Image();
        signature.src = "Signature.png";  // Achtung: gleiche Ordnerstruktur wie HTML-Datei
        signature.onload = () => {
        doc.addImage(signature, "PNG", 145, 220, 40, 20); // rechts unten
        };
          
        // PDF speichern
        doc.save("SecuraMentis_Abschluss.pdf");
      };
    };
  </script>
</body>
</html>
